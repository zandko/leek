import { generateVectorClassPrefixByDatasetId } from './generate.vector.class.prefix.by.dataset.id.util';

/**
 * Factory class for creating default configurations related to datasets.
 *
 * This class provides static methods to generate default values for dataset fields,
 * such as descriptions, retrieval models, and index structures.
 */
export class DatasetFactory {
  /**
   * Creates a default description for a dataset.
   *
   * The description is generated by concatenating a predefined prefix with the dataset name,
   * and ensuring there are no newline or carriage return characters.
   *
   * @param {string} name - The name of the dataset.
   * @returns {string} - The generated default description.
   */
  static createDefaultDescription(name: string): string {
    return ('useful for when you want to answer queries about the ' + name).replace(/\n/g, '').replace(/\r/g, '');
  }

  /**
   * Creates a default retrieval model configuration.
   *
   * The default retrieval model is defined with a fixed top-K value, a score threshold,
   * and a flag indicating whether the score threshold is enabled.
   *
   * @returns {LEEK.JsonValue} - The generated retrieval model configuration.
   */
  static createDefaultRetrievalModel(): LEEK.JsonValue {
    return {
      topK: 3,
      scoreThreshold: 0.5,
      scoreThresholdEnabled: false,
    };
  }

  /**
   * Creates a default index structure for a dataset.
   *
   * The index structure includes a type and a vector store configuration. The vector store
   * configuration includes a class prefix that is dynamically generated based on the dataset ID.
   *
   * @param {string} datasetId - The unique identifier of the dataset.
   * @param {string} [type='pgvector'] - The type of the index structure. Defaults to 'pgvector'.
   * @returns {LEEK.JsonValue} - The generated index structure configuration.
   */
  static createDefaultIndexStruct(datasetId: string, type: string = 'pgvector'): LEEK.JsonValue {
    return {
      type,
      vectorStore: {
        classPrefix: generateVectorClassPrefixByDatasetId(datasetId),
      },
    };
  }
}
